<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AbstractModelDefinitionPersistenceService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jmad-core</a> &gt; <a href="index.source.html" class="el_package">cern.accsoft.steering.jmad.modeldefs.io.impl</a> &gt; <span class="el_source">AbstractModelDefinitionPersistenceService.java</span></div><h1>AbstractModelDefinitionPersistenceService.java</h1><pre class="source lang-java linenums">package cern.accsoft.steering.jmad.modeldefs.io.impl;

import java.io.File;
import java.io.InputStream;
import java.io.OutputStream;

import cern.accsoft.steering.jmad.domain.beam.Beam;
import cern.accsoft.steering.jmad.domain.file.AbstractModelFile;
import cern.accsoft.steering.jmad.domain.file.CallableModelFileImpl;
import cern.accsoft.steering.jmad.domain.file.ModelPathOffsets;
import cern.accsoft.steering.jmad.domain.file.ModelPathOffsetsImpl;
import cern.accsoft.steering.jmad.domain.file.TableModelFileImpl;
import cern.accsoft.steering.jmad.domain.machine.MadxRange;
import cern.accsoft.steering.jmad.domain.machine.RangeDefinitionImpl;
import cern.accsoft.steering.jmad.domain.machine.SequenceDefinitionImpl;
import cern.accsoft.steering.jmad.domain.machine.filter.RegexNameFilter;
import cern.accsoft.steering.jmad.modeldefs.domain.JMadModelDefinition;
import cern.accsoft.steering.jmad.modeldefs.domain.JMadModelDefinitionImpl;
import cern.accsoft.steering.jmad.modeldefs.domain.OpticsDefinitionImpl;
import cern.accsoft.steering.jmad.modeldefs.io.JMadModelDefinitionExportRequest;
import cern.accsoft.steering.jmad.modeldefs.io.ModelDefinitionPersistenceService;
import cern.accsoft.steering.jmad.util.xml.GenericXStreamService;
import cern.accsoft.steering.jmad.util.xml.PersistenceService;
import cern.accsoft.steering.jmad.util.xml.PersistenceServiceException;
import com.thoughtworks.xstream.XStream;

<span class="fc" id="L27">public abstract class AbstractModelDefinitionPersistenceService implements ModelDefinitionPersistenceService {</span>
	@Override
	public JMadModelDefinition clone(JMadModelDefinition object) throws PersistenceServiceException {
<span class="fc" id="L30">		return this.getXStreamService().clone(object);</span>
	}

	@Override
	public String getFileExtension() {
<span class="fc" id="L35">		return this.getXStreamService().getFileExtension();</span>
	}

	@Override
	public boolean isCorrectFileName(String fileName) {
<span class="fc" id="L40">		return this.getXStreamService().isCorrectFileName(fileName);</span>
	}

	@Override
	public JMadModelDefinition load(File file) throws PersistenceServiceException {
<span class="nc" id="L45">		return this.getXStreamService().load(file);</span>
	}

	@Override
	public JMadModelDefinition load(InputStream inputStream) throws PersistenceServiceException {
<span class="fc" id="L50">		return this.getXStreamService().load(inputStream);</span>
	}

	@Override
	public File save(JMadModelDefinitionExportRequest object, File file) throws PersistenceServiceException {
<span class="fc" id="L55">		return this.getXStreamService().save(object.getModelDefinition(), file);</span>
	}

	@Override
	public void save(JMadModelDefinitionExportRequest object, OutputStream outStream)
			throws PersistenceServiceException {
<span class="fc" id="L61">		this.getXStreamService().save(object.getModelDefinition(), outStream);</span>
<span class="fc" id="L62">	}</span>

	/**
	 * @return the {@link GenericXStreamService} to use in this
	 *         {@link PersistenceService} for the {@link JMadModelDefinition}s
	 */
	protected abstract GenericXStreamService&lt;JMadModelDefinition&gt; getXStreamService();

	protected Class&lt;JMadModelDefinitionImpl&gt; getSaveableClass() {
<span class="fc" id="L71">		return JMadModelDefinitionImpl.class;</span>
	}

	protected final void configureXStream(XStream xStream) {
		/* and process the annotations of all classes we need */
<span class="fc" id="L76">		xStream.autodetectAnnotations(true);</span>
<span class="fc" id="L77">		Class&lt;?&gt;[] classes = new Class&lt;?&gt;[] { JMadModelDefinitionImpl.class, //</span>
				CallableModelFileImpl.class, //
				AbstractModelFile.class, //
				TableModelFileImpl.class, //
				Beam.class, //
				SequenceDefinitionImpl.class, //
				RangeDefinitionImpl.class, //
				OpticsDefinitionImpl.class, //
				MadxRange.class, //
				ModelPathOffsetsImpl.class, //
				RegexNameFilter.class };
<span class="fc" id="L88">		xStream.processAnnotations(classes);</span>

		/*
		 * To avoid using references
		 */
<span class="fc" id="L93">		xStream.addImmutableType(CallableModelFileImpl.class);</span>

		/* The default implementations */
<span class="fc" id="L96">		xStream.addDefaultImplementation(ModelPathOffsetsImpl.class, ModelPathOffsets.class);</span>
<span class="fc" id="L97">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>