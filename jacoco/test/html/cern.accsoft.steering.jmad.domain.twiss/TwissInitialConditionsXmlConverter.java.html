<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TwissInitialConditionsXmlConverter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jmad-core</a> &gt; <a href="index.source.html" class="el_package">cern.accsoft.steering.jmad.domain.twiss</a> &gt; <span class="el_source">TwissInitialConditionsXmlConverter.java</span></div><h1>TwissInitialConditionsXmlConverter.java</h1><pre class="source lang-java linenums">// @formatter:off
/*******************************************************************************
 * This file is part of JMad. Copyright (c) 2008-2011, CERN. All rights reserved. Licensed under the Apache License,
 * Version 2.0 (the &quot;License&quot;); you may not use this file except in compliance with the License. You may obtain a copy
 * of the License at http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable law or agreed to in
 * writing, software distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS
 * OF ANY KIND, either express or implied. See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
// @formatter:on

package cern.accsoft.steering.jmad.domain.twiss;

import cern.accsoft.steering.jmad.domain.var.enums.MadxTwissVariable;
import com.thoughtworks.xstream.converters.Converter;
import com.thoughtworks.xstream.converters.MarshallingContext;
import com.thoughtworks.xstream.converters.UnmarshallingContext;
import com.thoughtworks.xstream.io.HierarchicalStreamReader;
import com.thoughtworks.xstream.io.HierarchicalStreamWriter;

<span class="fc" id="L21">public class TwissInitialConditionsXmlConverter implements Converter {</span>

    /** The name off the attribute value */
    private static final String ATTR_NAME_VALUE = &quot;value&quot;;

    /**
     * @param ctx unused
     */
    @Override
    public void marshal(Object object, HierarchicalStreamWriter writer, MarshallingContext ctx) {

<span class="fc" id="L32">        TwissInitialConditionsImpl twiss = (TwissInitialConditionsImpl) object;</span>
<span class="fc" id="L33">        writer.addAttribute(&quot;name&quot;, twiss.getName());</span>

<span class="fc" id="L35">        writer.startNode(&quot;chrom&quot;);</span>
<span class="fc" id="L36">        writer.addAttribute(ATTR_NAME_VALUE, String.valueOf(twiss.isCalcChromaticFunctions()));</span>
<span class="fc" id="L37">        writer.endNode();</span>

<span class="fc" id="L39">        writer.startNode(&quot;closed-orbit&quot;);</span>
<span class="fc" id="L40">        writer.addAttribute(ATTR_NAME_VALUE, String.valueOf(twiss.isClosedOrbit()));</span>
<span class="fc" id="L41">        writer.endNode();</span>

<span class="fc" id="L43">        writer.startNode(&quot;centre&quot;);</span>
<span class="fc" id="L44">        writer.addAttribute(ATTR_NAME_VALUE, String.valueOf(twiss.isCalcAtCenter()));</span>
<span class="fc" id="L45">        writer.endNode();</span>

<span class="pc bpc" id="L47" title="1 of 2 branches missed.">        if (twiss.getPtcPhaseSpaceDimension() != null) {</span>
<span class="nc" id="L48">            writer.startNode(&quot;ptc-icase&quot;);</span>
<span class="nc" id="L49">            writer.addAttribute(ATTR_NAME_VALUE, String.valueOf(twiss.getPtcPhaseSpaceDimension()));</span>
<span class="nc" id="L50">            writer.endNode();</span>
        }

<span class="pc bpc" id="L53" title="1 of 2 branches missed.">        if (twiss.getPtcMapOrder() != null) {</span>
<span class="nc" id="L54">            writer.startNode(&quot;ptc-no&quot;);</span>
<span class="nc" id="L55">            writer.addAttribute(ATTR_NAME_VALUE, String.valueOf(twiss.getPtcMapOrder()));</span>
<span class="nc" id="L56">            writer.endNode();</span>
        }

<span class="pc bpc" id="L59" title="1 of 2 branches missed.">        if (twiss.getPtcBetz() != null) {</span>
<span class="nc" id="L60">            writer.startNode(&quot;ptc-betz&quot;);</span>
<span class="nc" id="L61">            writer.addAttribute(ATTR_NAME_VALUE, String.valueOf(twiss.getPtcBetz()));</span>
<span class="nc" id="L62">            writer.endNode();</span>
        }

<span class="pc bpc" id="L65" title="1 of 2 branches missed.">        if (twiss.getSaveBetaName() != null) {</span>
<span class="nc" id="L66">            writer.startNode(&quot;beta0&quot;);</span>
<span class="nc" id="L67">            writer.addAttribute(ATTR_NAME_VALUE, twiss.getSaveBetaName());</span>
<span class="nc" id="L68">            writer.endNode();</span>
        }

<span class="fc bfc" id="L71" title="All 2 branches covered.">        for (MadxTwissVariable variable : twiss.getMadxVariables()) {</span>
<span class="fc" id="L72">            Double value = twiss.getValue(variable);</span>
<span class="fc bfc" id="L73" title="All 2 branches covered.">            if (value != null) {</span>
<span class="fc" id="L74">                writer.startNode(variable.getMadxName().toLowerCase());</span>
<span class="fc" id="L75">                writer.addAttribute(ATTR_NAME_VALUE, value.toString());</span>
<span class="fc" id="L76">                writer.endNode();</span>
            }
<span class="fc" id="L78">        }</span>

<span class="fc" id="L80">    }</span>

    /**
     * @param ctx unused
     */
    @Override
    public Object unmarshal(HierarchicalStreamReader reader, UnmarshallingContext ctx) {

<span class="fc" id="L88">        String name = reader.getAttribute(&quot;name&quot;);</span>
<span class="fc" id="L89">        TwissInitialConditionsImpl retVal = new TwissInitialConditionsImpl(name);</span>

<span class="fc bfc" id="L91" title="All 2 branches covered.">        while (reader.hasMoreChildren()) {</span>
<span class="fc" id="L92">            reader.moveDown();</span>
<span class="fc" id="L93">            String nodeName = reader.getNodeName();</span>
<span class="fc bfc" id="L94" title="All 2 branches covered.">            if (&quot;chrom&quot;.equals(nodeName)) {</span>
<span class="fc" id="L95">                retVal.setCalcChromaticFunctions(Boolean.parseBoolean(reader.getAttribute(ATTR_NAME_VALUE)));</span>
<span class="fc bfc" id="L96" title="All 2 branches covered.">            } else if (&quot;closed-orbit&quot;.equals(nodeName)) {</span>
<span class="fc" id="L97">                retVal.setClosedOrbit(Boolean.parseBoolean(reader.getAttribute(ATTR_NAME_VALUE)));</span>
<span class="fc bfc" id="L98" title="All 2 branches covered.">            } else if (&quot;centre&quot;.equals(nodeName)) {</span>
<span class="fc" id="L99">                retVal.setCalcAtCenter(Boolean.parseBoolean(reader.getAttribute(ATTR_NAME_VALUE)));</span>
<span class="pc bpc" id="L100" title="1 of 2 branches missed.">            } else if (&quot;ptc-icase&quot;.equals(nodeName)) {</span>
<span class="nc" id="L101">                retVal.setPtcPhaseSpaceDimension(Integer.parseInt(reader.getAttribute(ATTR_NAME_VALUE)));</span>
<span class="pc bpc" id="L102" title="1 of 2 branches missed.">            } else if (&quot;ptc-no&quot;.equals(nodeName)) {</span>
<span class="nc" id="L103">                retVal.setPtcMapOrder(Integer.parseInt(reader.getAttribute(ATTR_NAME_VALUE)));</span>
<span class="pc bpc" id="L104" title="1 of 2 branches missed.">            } else if (&quot;ptc-betz&quot;.equals(nodeName)) {</span>
<span class="nc" id="L105">                retVal.setPtcBetz(Double.parseDouble(reader.getAttribute(ATTR_NAME_VALUE)));</span>
<span class="pc bpc" id="L106" title="1 of 2 branches missed.">            } else if (&quot;beta0&quot;.equals(nodeName)) {</span>
<span class="nc" id="L107">                retVal.setSaveBetaName(reader.getAttribute(ATTR_NAME_VALUE));</span>
            } else {
<span class="fc" id="L109">                MadxTwissVariable twissVariable = MadxTwissVariable.fromMadxName(nodeName);</span>
<span class="pc bpc" id="L110" title="1 of 2 branches missed.">                if (retVal.getMadxVariables().contains(twissVariable)) {</span>
<span class="fc" id="L111">                    retVal.setValue(twissVariable, Double.valueOf(reader.getAttribute(ATTR_NAME_VALUE)));</span>
                }
            }
<span class="fc" id="L114">            reader.moveUp();</span>
<span class="fc" id="L115">        }</span>
<span class="fc" id="L116">        return retVal;</span>
    }

    @Override
    public boolean canConvert(Class clazz) {
<span class="fc" id="L121">        return clazz.equals(TwissInitialConditionsImpl.class);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>